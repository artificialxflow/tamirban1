# مستندات ایندکس‌های MongoDB

این مستندات تمام ایندکس‌های ایجاد شده در دیتابیس MongoDB را شرح می‌دهد.

## نحوه اجرای Migration

برای ایجاد تمام ایندکس‌ها، از script زیر استفاده کنید:

```bash
node scripts/migrations/add-all-indexes.js
```

## ایندکس‌های Customers Collection

### ایندکس‌های تک فیلدی

1. **contact.phones (1)**
   - برای جستجوی سریع بر اساس شماره تلفن
   - استفاده در: جستجوی مشتریان بر اساس شماره تلفن

2. **contact.primaryPhone (1)**
   - برای جستجوی سریع بر اساس شماره تلفن اصلی
   - استفاده در: جستجوی مشتریان

3. **displayName (text)**
   - برای جستجوی متنی در نام مشتری
   - استفاده در: جستجوی مشتریان بر اساس نام

4. **status (1)**
   - برای فیلتر کردن بر اساس وضعیت
   - استفاده در: فیلتر مشتریان بر اساس وضعیت

5. **assignedMarketerId (1)**
   - برای فیلتر کردن بر اساس بازاریاب
   - استفاده در: نمایش مشتریان هر بازاریاب

6. **contact.city (1)**
   - برای فیلتر کردن بر اساس شهر
   - استفاده در: فیلتر مشتریان بر اساس شهر

7. **tags (1)**
   - برای فیلتر کردن بر اساس برچسب‌ها
   - استفاده در: فیلتر مشتریان بر اساس برچسب

### ایندکس‌های ترکیبی

1. **status (1) + assignedMarketerId (1)**
   - برای جستجوهای ترکیبی وضعیت و بازاریاب
   - استفاده در: نمایش مشتریان یک بازاریاب با وضعیت خاص

### ایندکس‌های Geospatial

1. **location.coordinates (2dsphere)**
   - برای جستجوهای مکانی
   - استفاده در: جستجوی مشتریان نزدیک به یک موقعیت جغرافیایی

## ایندکس‌های Visits Collection

### ایندکس‌های تک فیلدی

1. **customerId (1)**
   - برای جستجوی ویزیت‌های یک مشتری
   - استفاده در: نمایش تاریخچه ویزیت‌های یک مشتری

2. **marketerId (1)**
   - برای جستجوی ویزیت‌های یک بازاریاب
   - استفاده در: نمایش ویزیت‌های یک بازاریاب

3. **scheduledAt (-1)**
   - برای مرتب‌سازی بر اساس تاریخ برنامه‌ریزی (نزولی)
   - استفاده در: نمایش ویزیت‌ها به ترتیب تاریخ

4. **status (1)**
   - برای فیلتر کردن بر اساس وضعیت
   - استفاده در: فیلتر ویزیت‌ها بر اساس وضعیت

5. **visitType (1)**
   - برای فیلتر کردن بر اساس نوع ویزیت
   - استفاده در: فیلتر ویزیت‌های حضوری یا تلفنی

### ایندکس‌های ترکیبی

1. **marketerId (1) + scheduledAt (-1) + status (1)**
   - برای جستجوهای پیشرفته
   - استفاده در: نمایش ویزیت‌های یک بازاریاب با وضعیت خاص به ترتیب تاریخ

## ایندکس‌های Invoices Collection

ایندکس‌های invoices از طریق script جداگانه ایجاد می‌شوند:

```bash
node scripts/migrations/add-invoice-indexes.js
```

### ایندکس‌های موجود

1. **customerId (1)**
2. **status (1)**
3. **dueAt (1)**
4. **marketerId (1)**
5. **customerId (1) + status (1) + dueAt (-1)** (ترکیبی)

## ایندکس‌های Users Collection

### ایندکس‌های تک فیلدی

1. **profile.region (1)**
   - برای فیلتر کردن بازاریاب‌ها بر اساس منطقه
   - استفاده در: نمایش بازاریاب‌های یک منطقه

2. **isActive (1)**
   - برای فیلتر کردن کاربران فعال
   - استفاده در: نمایش فقط کاربران فعال

3. **role (1)**
   - برای فیلتر کردن بر اساس نقش
   - استفاده در: نمایش کاربران با نقش خاص

## ایندکس‌های Customer Interactions Collection

### ایندکس‌های تک فیلدی

1. **customerId (1)**
   - برای جستجوی تعاملات یک مشتری
   - استفاده در: نمایش تاریخچه تعاملات

2. **createdAt (-1)**
   - برای مرتب‌سازی بر اساس تاریخ ایجاد (نزولی)
   - استفاده در: نمایش تعاملات به ترتیب تاریخ

### ایندکس‌های ترکیبی

1. **customerId (1) + createdAt (-1)**
   - برای جستجو و مرتب‌سازی تعاملات یک مشتری
   - استفاده در: نمایش تاریخچه تعاملات یک مشتری به ترتیب تاریخ

## ایندکس‌های Products Collection

### ایندکس‌های تک فیلدی

1. **isActive (1)**
   - برای فیلتر کردن محصولات فعال
   - استفاده در: نمایش فقط محصولات فعال

2. **name (text)**
   - برای جستجوی متنی در نام محصول
   - استفاده در: جستجوی محصولات بر اساس نام

## ایندکس‌های Tasks Collection

### ایندکس‌های تک فیلدی

1. **assignedTo (1)**
   - برای جستجوی تسک‌های یک کاربر
   - استفاده در: نمایش تسک‌های اختصاص داده شده به یک کاربر

2. **status (1)**
   - برای فیلتر کردن بر اساس وضعیت
   - استفاده در: فیلتر تسک‌ها بر اساس وضعیت

3. **dueAt (1)**
   - برای جستجوی تسک‌های با تاریخ سررسید
   - استفاده در: نمایش تسک‌های معوق

### ایندکس‌های ترکیبی

1. **assignedTo (1) + status (1)**
   - برای جستجوهای پیشرفته
   - استفاده در: نمایش تسک‌های یک کاربر با وضعیت خاص

## نکات مهم

1. **ایندکس‌های موجود**: اگر ایندکسی از قبل وجود داشته باشد، script خطا نمی‌دهد و فقط پیام می‌دهد که ایندکس موجود است.

2. **ایمنی**: این migration فقط ایندکس ایجاد می‌کند و داده‌ها را تغییر نمی‌دهد.

3. **زمان اجرا**: برای دیتابیس‌های بزرگ، ایجاد ایندکس ممکن است چند دقیقه طول بکشد.

4. **بهینه‌سازی**: ایندکس‌ها برای بهبود عملکرد query‌ها طراحی شده‌اند. استفاده بیش از حد از ایندکس‌ها می‌تواند سرعت نوشتن را کاهش دهد.

5. **Text Index**: ایندکس‌های text فقط یک بار در هر collection می‌توانند ایجاد شوند. اگر نیاز به جستجوی متنی در چند فیلد دارید، از ایندکس compound text استفاده کنید.

## بررسی ایندکس‌های موجود

برای بررسی ایندکس‌های موجود در یک collection:

```javascript
// در MongoDB shell
db.customers.getIndexes()
db.visits.getIndexes()
db.invoices.getIndexes()
```

## حذف ایندکس

برای حذف یک ایندکس (در صورت نیاز):

```javascript
// در MongoDB shell
db.customers.dropIndex("index_name")
```

**هشدار**: حذف ایندکس‌ها می‌تواند عملکرد query‌ها را کاهش دهد. فقط در صورت نیاز این کار را انجام دهید.

